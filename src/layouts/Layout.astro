---
import PriceDisplay from '../components/PriceDisplay.astro';
import WalletConnect from '../components/WalletConnect.astro';
import PWAInstallPrompt from '../components/PWAInstallPrompt.astro';
import MegaMenu from '../components/MegaMenu.astro';
import '../styles/accessibility.css';
import { initializeAnalytics } from '../lib/analytics';

export interface Props {
  title: string;
  description?: string;
  keywords?: string;
  ogImage?: string;
  ogType?: string;
  canonicalUrl?: string;
}

const { 
  title, 
  description = "My Blog - Smart money analytics and insights",
  keywords,
  ogImage,
  ogType = "website",
  canonicalUrl
} = Astro.props;

// Get the current pathname for active link detection
const pathname = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    {keywords && <meta name="keywords" content={keywords} />}
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/img/blog-brand/blog-logo-no-bg.png" />
    <title>{title} | My Blog</title>
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#00d9ff" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="My Blog" />
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Karla:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    
    <!-- Preconnect to improve performance -->
    <link rel="preconnect" href="https://api.example.ai" />
    <link rel="dns-prefetch" href="https://api.example.ai" />
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MKHQ0SV8Q2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-MKHQ0SV8Q2');
    </script>
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content={`${title} | My Blog`} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={Astro.url.href} />
    <meta property="og:site_name" content="My Blog" />
    {ogImage && <meta property="og:image" content={ogImage.startsWith('http') ? ogImage : `${Astro.url.origin}${ogImage}`} />}
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content={ogImage ? "summary_large_image" : "summary"} />
    <meta name="twitter:title" content={`${title} | My Blog`} />
    <meta name="twitter:description" content={description} />
    {ogImage && <meta name="twitter:image" content={ogImage.startsWith('http') ? ogImage : `${Astro.url.origin}${ogImage}`} />}
    <meta name="twitter:site" content="@myblog" />
    
    <!-- Canonical URL -->
    {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}
    
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://api.example.ai" />
    <link rel="dns-prefetch" href="https://api.example.ai" />
    <link rel="preconnect" href="https://ui-avatars.com" />
    <link rel="dns-prefetch" href="https://ui-avatars.com" />
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="My Blog Blog RSS Feed" href="/rss.xml" />
    
    <!-- Google Fonts: Inter for body/headings, Source Sans 3 for UI elements -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Load fonts with variable font support -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Source+Sans+3:wght@200..900&display=swap" rel="stylesheet">
    
    <!-- Critical CSS for improved load times -->
    <style>
      /* Critical CSS - Above the fold styles */
      :root {
        --color-primary: #818CF8;
        --color-primary-dark: #6366F1;
        --color-primary-light: #A5B4FC;
        --color-secondary: #A78BFA;
        --color-accent: #34D399;
        --color-tertiary: #FBBF24;
        --color-highlight: #60A5FA;
        --color-background: #0F172A;
        --color-background-secondary: #1E293B;
        --color-surface: #1E293B;
        --color-surface-light: #334155;
        --color-text: #F1F5F9;
        --color-text-muted: #94A3B8;
        --color-text-light: #64748B;
        --color-border: #334155;
        
        /* Font families */
        --font-family-base: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        --font-family-heading: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        --font-family-mono: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;
        --font-family-nav: 'Source Sans 3', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      
      /* Light mode removed - dark theme only */
      
      :root {
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        --space-2xl: 3rem;
        --space-3xl: 4rem;
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        --text-4xl: 2.25rem;
        --radius-sm: 0.25rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --transition-base: 0.2s ease;
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      html {
        font-family: var(--font-family-base);
        background: var(--color-background);
        color: var(--color-text);
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-feature-settings: 'cv01', 'cv02', 'cv03', 'cv04';
      }
      
      body {
        font-family: var(--font-family-base);
        font-weight: 400;
      }
      
      body {
        margin: 0;
        min-height: 100vh;
        background: var(--color-background);
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }
      
      .hero, .hero-section {
        position: relative;
        padding: var(--space-2xl) 0;
        overflow: hidden;
      }
      
      h1, h2, h3 {
        font-weight: 700;
        line-height: 1.2;
      }
      
      a {
        color: inherit;
        text-decoration: none;
      }
      
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        transition: all var(--transition-base);
        cursor: pointer;
        border: none;
      }
      
      .btn-primary {
        background: var(--color-primary);
        color: white;
      }
      
      .btn-primary:hover {
        background: var(--color-primary-dark);
        transform: translateY(-2px);
      }
      
      /* Navigation critical styles */
      nav {
        position: sticky;
        top: 0;
        z-index: 1001;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--color-border);
      }
      
      /* Loading state */
      .loading {
        opacity: 0;
        animation: fadeIn 0.3s ease forwards;
      }
      
      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }
    </style>
    
    <!-- Accessibility Styles are included in global styles below -->
    
    <!-- Dark theme only -->
    <script>
      document.documentElement.setAttribute('data-theme', 'dark');
    </script>
  </head>
  <body>

    <!-- Skip to main content link for screen readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="nav-overlay"></div>
    <nav class="nav" role="navigation" aria-label="Main navigation">
      <div class="nav-container">
        <!-- Top Row: Logo, Search, Price + Wallet -->
        <div class="nav-top-row">
          <div class="nav-top-content">
            <!-- Logo -->
            <a href="/" class="nav-logo" aria-label="My Blog Home">
              <img src="/img/blog-brand/blog-logo.png" alt="My Blog Logo" class="nav-logo-img" />
            </a>
            
            <!-- Site Search -->
            <div class="nav-search">
              <form class="search-form" id="search-form" action="/search" method="get">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input 
                  type="search" 
                  name="q"
                  class="search-input" 
                  id="search-input-nav" 
                  placeholder="Search..."
                  aria-label="Search"
                  autocomplete="off"
                />
                <kbd class="search-shortcut">âŒ˜K</kbd>
              </form>
            </div>
            
            <!-- Right side: Price + Wallet -->
            <div class="nav-actions">
              <div class="header-price-wrapper">
                <PriceDisplay />
              </div>
              <WalletConnect />
            </div>
            
            <!-- Mobile menu toggle -->
            <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
              <span class="hamburger"></span>
              <span class="hamburger"></span>
              <span class="hamburger"></span>
            </button>
          </div>
        </div>
        
        <!-- Bottom Row: Navigation Links -->
        <div class="nav-bottom-row">
          <div class="nav-bottom-content">
            <!-- Mobile Search at top of menu -->
            <div class="mobile-search">
              <form class="mobile-search-form" action="/search" method="get">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mobile-search-icon">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                  type="search"
                  name="q"
                  class="mobile-search-input"
                  placeholder="Search..."
                  aria-label="Search"
                  autocomplete="off"
                />
              </form>
            </div>
            <!-- Token Price in mobile menu -->
            <div class="mobile-price">
              <PriceDisplay />
            </div>
            <ul class="nav-links" role="list">
              <li><a href="/" class={`nav-link ${pathname === '/' ? 'active' : ''}`} aria-current={pathname === '/' ? 'page' : undefined}>Home</a></li>
              <li class="has-mega-menu">
                <a href="/smart-money/dashboard" class={`nav-link ${pathname.startsWith('/smart-money') ? 'active' : ''}`} aria-current={pathname.startsWith('/smart-money') ? 'page' : undefined} data-mega-menu-trigger="smart-money">
                  Smart Money
                  <svg class="nav-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </a>
              </li>
              <li><a href="/team" class={`nav-link ${pathname === '/team' ? 'active' : ''}`} aria-current={pathname === '/team' ? 'page' : undefined}>Team</a></li>
              <li><a href="/tokenomics" class={`nav-link ${pathname === '/tokenomics' ? 'active' : ''}`} aria-current={pathname === '/tokenomics' ? 'page' : undefined}>Tokenomics</a></li>
              <li><a href="/blog" class={`nav-link ${pathname === '/blog' || pathname.startsWith('/blog/') ? 'active' : ''}`} aria-current={pathname === '/blog' || pathname.startsWith('/blog/') ? 'page' : undefined}>Blog</a></li>
              <li><a href="/ui-kit" class={`nav-link ${pathname === '/ui-kit' || pathname.startsWith('/ui-kit/') ? 'active' : ''}`} aria-current={pathname === '/ui-kit' || pathname.startsWith('/ui-kit/') ? 'page' : undefined}>UIKit</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <!-- Mega Menu Component -->
    <MegaMenu />

    <main id="main-content" role="main">
      <slot />
    </main>
    <footer class="footer" role="contentinfo">
      <div class="container">
        <div class="footer-disclaimer">
          <p><strong>Disclaimer:</strong> The information provided by My Blog is for informational purposes only and should not be considered financial advice. Cryptocurrency investments carry significant risk. Always conduct your own research and consult with qualified financial advisors before making investment decisions. My Blog is not responsible for any losses incurred from using this information.</p>
        </div>
        <div class="footer-content">
          <!-- Logo and Description Column -->
          <div class="footer-brand">
            <div class="footer-logo">
              <img src="/img/blog-brand/blog-logo.png" alt="My Blog Logo" class="footer-logo-img" />
            </div>
            <div class="footer-description">
              <p>My Blog provides advanced cryptocurrency analysis and smart money insights to help traders make informed decisions in the digital asset space.</p>
            </div>
          </div>
          
          <!-- Primary Navigation Column -->
          <div class="footer-nav">
            <h3>Navigation</h3>
            <ul class="footer-nav-list">
              <li><a href="/">Home</a></li>
              <li><a href="/smart-money/dashboard">Smart Money</a></li>
              <li><a href="/team">Team</a></li>
              <li><a href="/tokenomics">Tokenomics</a></li>
              <li><a href="/blog">Blog</a></li>
              <li><a href="/ui-kit">UIKit</a></li>
            </ul>
          </div>
          
          <!-- Social Links Column -->
          <div class="footer-social">
            <h3>Community</h3>
            <ul class="footer-social-list">
              <li><a href="https://discord.gg/blogai" target="_blank" rel="noopener noreferrer">Discord</a></li>
              <li><a href="#" target="_blank" rel="noopener noreferrer">Twitter</a></li>
              <li><a href="#" target="_blank" rel="noopener noreferrer">GitHub</a></li>
            </ul>
          </div>
          
          <!-- Legal Links Column -->
          <div class="footer-legal">
            <h3>Legal</h3>
            <ul class="footer-legal-list">
              <li><a href="/sitemap">Sitemap</a></li>
              <li><a href="/marketing-consent">Marketing Consent</a></li>
            </ul>
          </div>
        </div>
        
        <!-- Copyright -->
        <div class="footer-bottom">
          <p>&copy; {new Date().getFullYear()} My Blog. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script type="text/javascript" defer>
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "t8o4vabubx");
  </script>
    
    <script>
      // Theme toggle removed - using dark theme only

      // Handle scroll effects
      const nav = document.querySelector('.nav');
      let lastScroll = 0;
      
      window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
        
        if (nav) {
          if (currentScroll > 50) {
            nav.classList.add('scrolled');
          } else {
            nav.classList.remove('scrolled');
          }
        }
        
        lastScroll = currentScroll;
      });
      
      // Handle mega menu trigger
      const megaMenuTrigger = document.querySelector('[data-mega-menu-trigger="smart-money"]');
      const megaMenuWrapper = document.querySelector('.mega-menu-wrapper[data-menu="smart-money"]');
      const megaMenuBackdrop = document.querySelector('.mega-menu-backdrop[data-menu-backdrop="smart-money"]');
      const hasMenuLi = document.querySelector('.has-mega-menu');

      if (megaMenuTrigger && megaMenuWrapper && megaMenuBackdrop) {
        let megaMenuTimeout;

        // Desktop: Show on hover
        if (window.innerWidth > 768) {
          hasMenuLi.addEventListener('mouseenter', () => {
            clearTimeout(megaMenuTimeout);
            megaMenuWrapper.classList.add('active');
            megaMenuBackdrop.classList.add('active');
          });

          hasMenuLi.addEventListener('mouseleave', () => {
            megaMenuTimeout = setTimeout(() => {
              megaMenuWrapper.classList.remove('active');
              megaMenuBackdrop.classList.remove('active');
            }, 100);
          });

          megaMenuWrapper.addEventListener('mouseenter', () => {
            clearTimeout(megaMenuTimeout);
          });

          megaMenuWrapper.addEventListener('mouseleave', () => {
            megaMenuWrapper.classList.remove('active');
            megaMenuBackdrop.classList.remove('active');
          });

          megaMenuBackdrop.addEventListener('click', () => {
            megaMenuWrapper.classList.remove('active');
            megaMenuBackdrop.classList.remove('active');
          });

          // Allow navigation to /smart-money/dashboard on desktop
          megaMenuTrigger.addEventListener('click', (e) => {
            // Don't prevent default - allow navigation
          });
        }
      }

      // Handle search functionality
      const searchForm = document.getElementById('search-form') as HTMLFormElement;
      const searchInput = document.getElementById('search-input-nav') as HTMLInputElement;
      
      if (searchForm && searchInput) {
        // Focus search input on Cmd+K or Ctrl+K
        document.addEventListener('keydown', (e) => {
          if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            searchInput.focus();
            searchInput.select();
          }
        });
        
        // Handle form submission
        searchForm.addEventListener('submit', (e) => {
          const query = searchInput.value.trim();
          if (!query) {
            e.preventDefault(); // Prevent empty searches
          }
        });
      }

      // Handle mobile menu
      const navToggle = document.querySelector('.nav-toggle');
      const navBottomRow = document.querySelector('.nav-bottom-row');
      const navOverlay = document.querySelector('.nav-overlay');
      
      if (navToggle && navBottomRow && navOverlay) {
        navToggle.addEventListener('click', () => {
          const isExpanded = navToggle.getAttribute('aria-expanded') === 'true';
          navToggle.setAttribute('aria-expanded', String(!isExpanded));
          navBottomRow.classList.toggle('active');
          navToggle.classList.toggle('active');
          navOverlay.classList.toggle('active');
        });
        
        // Close menu when clicking overlay
        navOverlay.addEventListener('click', () => {
          navToggle.setAttribute('aria-expanded', 'false');
          navBottomRow.classList.remove('active');
          navToggle.classList.remove('active');
          navOverlay.classList.remove('active');
        });
        
        // Close menu when clicking a link (except mega menu trigger on mobile)
        const links = navBottomRow.querySelectorAll('.nav-link');
        links.forEach(link => {
          link.addEventListener('click', () => {
            // Don't close menu if clicking mega menu trigger on mobile
            const isMegaMenuTrigger = link.closest('.has-mega-menu');
            const isMobile = window.innerWidth <= 768;

            if (isMegaMenuTrigger && isMobile && link.classList.contains('nav-link')) {
              // Let the mega menu handler handle this
              return;
            }

            navToggle.setAttribute('aria-expanded', 'false');
            navBottomRow.classList.remove('active');
            navToggle.classList.remove('active');
            navOverlay.classList.remove('active');
          });
        });
      }

      // Handle orientation changes and window resize
      const handleOrientationAndResize = () => {
        const navToggle = document.querySelector('.nav-toggle');
        const navBottomRow = document.querySelector('.nav-bottom-row');
        const navOverlay = document.querySelector('.nav-overlay');

        if (navToggle && navBottomRow && navOverlay) {
          // Always reset the menu state on viewport change
          navToggle.setAttribute('aria-expanded', 'false');
          navBottomRow.classList.remove('active');
          navToggle.classList.remove('active');
          navOverlay.classList.remove('active');

          // Force a reflow to ensure styles are applied correctly after state change
          // This is a common technique to avoid transition bugs on menu close
          navBottomRow.style.display = 'none';
          navBottomRow.offsetHeight; // Trigger reflow
          navBottomRow.style.display = '';

          // Re-enable the toggle button if it was disabled
          navToggle.disabled = false;
          navToggle.style.pointerEvents = 'auto';
        }
      };

      // Use a single, debounced resize listener for all viewport changes
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(handleOrientationAndResize, 150);
      });
    </script>

    <!-- Global Wallet State Initialization -->
    <script>
      // Initialize wallet state from storage
      (function() {
        function initializeWalletState() {
          // Check authentication state
          const token = sessionStorage.getItem('smart-money-token');
          const tokenExpiry = sessionStorage.getItem('smart-money-token-expiry');
          const hasValidToken = token && tokenExpiry && Date.now() < parseInt(tokenExpiry);
          
          const isVerified = sessionStorage.getItem('token-gate-verified') === 'true';
          const hasAccess = sessionStorage.getItem('wallet-has-access') === 'true';
          const walletAddress = localStorage.getItem('walletAddress');
          const walletConnected = localStorage.getItem('walletConnected') === 'true';
          const balance = sessionStorage.getItem('blog-balance') || sessionStorage.getItem('wallet-balance') || '0';
          
          // Set global wallet state
          window.walletState = {
            isConnected: walletConnected && !!walletAddress && hasValidToken,
            hasAccess: isVerified && hasAccess,
            address: walletAddress,
            balance: balance,
            token: hasValidToken ? token : null
          };
          
          console.log('Global wallet state initialized:', {
            isConnected: window.walletState.isConnected,
            hasAccess: window.walletState.hasAccess,
            address: window.walletState.address ? window.walletState.address.slice(0, 6) + '...' : null
          });
          
          // Dispatch event if authenticated
          if (window.walletState.isConnected) {
            setTimeout(() => {
              window.dispatchEvent(new CustomEvent('walletStateInitialized', {
                detail: window.walletState
              }));
            }, 100);
          }
        }
        
        // Run on page load
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initializeWalletState);
        } else {
          initializeWalletState();
        }
        
        // Also expose a method to refresh state
        window.refreshWalletState = initializeWalletState;
      })();
    </script>
    
    <!-- PWA Install Prompt -->
    <PWAInstallPrompt />

    <!-- Service Worker Registration -->
    <script src="/sw-register.js" defer></script>

    <!-- Initialize Analytics -->
    <script>
      // Initialize analytics safely after page load
      document.addEventListener('DOMContentLoaded', function() {
        try {
          if (typeof window !== 'undefined' && window.gtag) {
            // Basic page view tracking
            window.gtag('config', 'G-MKHQ0SV8Q2', {
              page_title: document.title,
              page_location: window.location.href,
            });
            
            // Add global error handler
            window.addEventListener('error', function(event) {
              if (window.gtag) {
                window.gtag('event', 'error_occurred', {
                  event_category: 'error',
                  event_label: 'javascript_error',
                  custom_parameters: {
                    error_message: event.message || 'unknown'
                  }
                });
              }
            });
            
            // Add unhandled promise rejection handler
            window.addEventListener('unhandledrejection', function(event) {
              if (window.gtag) {
                window.gtag('event', 'error_occurred', {
                  event_category: 'error',
                  event_label: 'promise_rejection',
                  custom_parameters: {
                    error_message: event.reason?.toString() || 'unknown'
                  }
                });
              }
            });
          }
        } catch (error) {
          console.warn('Analytics initialization failed:', error);
        }
      });
    </script>
    
    <!-- Wallet persistence manager - loads before React to maintain state -->
    <script src="/scripts/walletPersistence.js" is:inline></script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>

<style>
  /* Two-row Navigation Layout */
  .nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1001;
    background-color: rgba(15, 23, 42, 0.98);
    backdrop-filter: blur(12px);
    transition: all 0.3s ease;
    border-bottom: 1px solid var(--color-border);
  }

  .nav.scrolled {
    background-color: rgba(15, 23, 42, 0.98);
    box-shadow: var(--shadow-md);
  }

  .nav-container {
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Top Row */
  .nav-top-row {
    border-bottom: 1px solid var(--color-border);
  }

  .nav-top-content {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 5px var(--space-lg) 0; /* Added 5px padding-top */
    height: 80px; /* Increased from 64px to accommodate larger logo */
    gap: var(--space-md);
  }

  /* Search Bar */
  .nav-search {
    flex: 0 0 auto;
    width: 300px;
    order: 2;
    margin-right: var(--space-sm);
  }

  .search-form {
    width: 100%;
    position: relative;
    display: flex;
    align-items: center;
  }

  /* Corner accent - bottom-right only with purple color */
  .search-form::before {
    content: '';
    position: absolute;
    bottom: -1px;
    right: -1px;
    width: 36px;
    height: 36px;
    border-bottom: 3px solid #7B3FF2;
    border-right: 3px solid #7B3FF2;
    border-bottom-right-radius: var(--radius-lg);
    z-index: 2;
    pointer-events: none;
  }

  .search-icon {
    position: absolute;
    left: 1rem;
    width: 16px;
    height: 16px;
    color: var(--color-text-muted);
    pointer-events: none;
    z-index: 3;
  }

  .search-input {
    width: 100%;
    padding: 0.5rem 3rem 0.5rem 2.5rem;
    background: rgba(17, 17, 19, 0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: var(--radius-lg);
    color: var(--color-text);
    font-size: 0.875rem;
    transition: all var(--transition-base);
    outline: thin solid rgba(255, 255, 255, 0.27) !important;
  }

  .search-input::placeholder {
    color: var(--color-text-muted);
  }

  .search-input:focus {
    border-color: rgba(255, 255, 255, 0.12);
    background: rgba(17, 17, 19, 0.8);
    box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.15);
  }

  .search-shortcut {
    position: absolute;
    right: 1rem;
    padding: 2px 6px;
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-text-muted);
    pointer-events: none;
  }

  /* Nav Actions */
  .nav-actions {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    order: 3;
  }

  /* Bottom Row */
  .nav-bottom-row {
    height: 48px;
    border-bottom: thin solid seagreen;
  }

  .nav-bottom-content {
    padding: 0 var(--space-lg);
    height: 100%;
  }

  .nav-logo {
    font-family: var(--font-family-nav);
    font-size: 16px;
    font-weight: 600;
    font-optical-sizing: auto;
    font-style: normal;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--color-text);
    flex: 1;
    order: 1;
  }

  /* Remove focus outline from nav-logo */
  .nav-logo:focus-visible {
    outline: none;
  }

  .nav-logo-img {
    width: 68px;  /* Reduced by ~13% from 78px */
    height: 57px; /* Reduced by ~12% from 65px */
    /* border-radius: 50%; */
    object-fit: cover;
    transition: all var(--transition-base);
    margin: 5px 0; /* Added 5px top and bottom margin for proper spacing */
  }

  .nav-logo:hover .nav-logo-img {
    transform: scale(1.05);
  }
  
  /* Logo text */
  .nav-logo span {
    color: var(--color-text);
    font-weight: 700;
  }
  
  /* Price display item */
  .price-display-item {
    margin-left: 8px;
    font-size: 14px !important;
  }

  /* Ensure price display doesn't inherit wrong sizes */
  .price-display-item * {
    font-size: inherit !important;
  }

  /* Wallet connect item */
  .wallet-connect-item {
    margin-left: 8px;
  }

  /* Theme toggle removed - using dark theme only */

  .nav-links {
    display: flex;
    gap: var(--space-xl);
    align-items: center;
    height: 100%;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .nav-links li {
    height: 100%;
    display: flex;
    align-items: center;
  }

  .nav-link {
    font-family: var(--font-family-nav);
    color: #fff;
    font-size: 1rem;
    font-weight: 500;
    text-transform: uppercase;
    height: 100%;
    display: flex;
    align-items: center;
    position: relative;
    padding: 0 var(--space-xs);
    font-optical-sizing: auto;
    font-style: normal;
    letter-spacing: 0.02em;
    transition: color var(--transition-base);
    position: relative;
    white-space: nowrap; /* Prevent line breaks */
  }

  /* Mega menu trigger styles */
  .has-mega-menu {
    position: relative;
  }

  .has-mega-menu .nav-link {
    display: flex;
    align-items: center;
    gap: 4px;
    white-space: nowrap;
    cursor: pointer;
  }

  .nav-arrow {
    transition: transform var(--transition-base);
  }

  .has-mega-menu:hover .nav-arrow {
    transform: rotate(180deg);
  }

  .nav-link:hover {
    color: var(--color-primary);
  }

  /* Remove underline from all nav links by default */
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--color-primary);
    transition: width var(--transition-base);
  }

  /* Remove hover underline effect */
  /* .nav-link:hover::after {
    width: 100%;
  } */


  /* Mobile mega menu styling - handled by MegaMenu component */
  @media (max-width: 870px) {
    .has-mega-menu .nav-link {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }
  }

  /* Active link styles - only active page gets underline */
  .nav-link.active {
    color: var(--color-text);
    font-weight: 600;
  }

  .nav-link.active::after {
    width: 100%;
  }

  .footer {
    background: linear-gradient(180deg,
      var(--color-background) 0%,
      rgba(17, 17, 19, 0.98) 50%,
      var(--color-background-secondary) 100%);
    border-top: 1px solid rgba(0, 212, 255, 0.1);
    padding: 4rem 0 2rem;
    margin-top: 6rem;
    position: relative;
    overflow: hidden;
  }

  .footer::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg,
      transparent,
      var(--color-primary),
      var(--color-secondary),
      var(--color-accent),
      transparent);
    animation: gradient-slide 5s ease infinite;
  }

  .footer-disclaimer {
    margin-bottom: 3rem;
    padding: 1.5rem;
    background: linear-gradient(135deg,
      rgba(26, 26, 29, 0.6),
      rgba(37, 37, 41, 0.6));
    border: 1px solid rgba(255, 165, 2, 0.2);
    border-radius: 1rem;
    backdrop-filter: blur(10px);
    position: relative;
  }

  .footer-disclaimer::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg,
      var(--color-warning),
      transparent);
  }

  .footer-disclaimer p {
    font-size: 0.875rem;
    line-height: 1.6;
    color: var(--color-text-muted);
    text-align: center;
    margin: 0;
  }

  .footer-disclaimer strong {
    color: var(--color-warning);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .footer-content {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: var(--space-xl);
    margin-bottom: var(--space-lg);
  }

  .footer-brand {
    max-width: 300px;
  }

  .footer-logo {
    margin-bottom: var(--space-md);
  }

  .footer-logo-img {
    height: 40px;
    width: auto;
  }

  .footer-description p {
    font-size: 0.875rem;
    line-height: 1.6;
    color: var(--color-text-muted);
    margin: 0;
    max-width: 250px;
  }

  .footer-nav h3,
  .footer-social h3,
  .footer-legal h3 {
    font-size: 0.875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-primary);
    margin: 0 0 1rem 0;
    position: relative;
    padding-left: 0.75rem;
  }

  /* Orientation-specific fixes for mobile menu */
  @media screen and (orientation: landscape) and (max-width: 768px) {
    .nav-bottom-row {
      top: 64px !important;
    }
  }

  /* iOS-specific fixes for hamburger menu */
  @supports (-webkit-touch-callout: none) {
    @media screen and (max-width: 768px) {
      .nav-toggle {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }

      .nav-bottom-row {
        -webkit-overflow-scrolling: touch;
      }
    }
  }

  /* Add negative margin on larger viewports for proper alignment */
  @media (min-width: 769px) {
    .footer-nav h3,
    .footer-social h3,
    .footer-legal h3 {
      margin-left: -10px;
    }
  }

  @media (min-width: 769px) {
    .footer-nav h3::before,
    .footer-social h3::before,
    .footer-legal h3::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 12px;
      background: linear-gradient(180deg, var(--color-primary), var(--color-secondary));
      border-radius: 2px;
    }
  }

  .footer-nav-list,
  .footer-social-list,
  .footer-legal-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .footer-nav-list li,
  .footer-social-list li,
  .footer-legal-list li {
    margin-bottom: 0.25rem;
  }

  .footer-nav-list li:last-child,
  .footer-social-list li:last-child,
  .footer-legal-list li:last-child {
    margin-bottom: 0;
  }

  .footer-nav-list a,
  .footer-social-list a,
  .footer-legal-list a {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-block;
    position: relative;
    line-height: 1.4;
    padding: 0.125rem 0;
  }

  .footer-nav-list a::after,
  .footer-social-list a::after,
  .footer-legal-list a::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -2px;
    width: 0;
    height: 1px;
    background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
    transition: width 0.3s ease;
  }

  .footer-nav-list a:hover,
  .footer-social-list a:hover,
  .footer-legal-list a:hover {
    color: var(--color-primary);
    transform: translateX(4px);
  }

  .footer-nav-list a:hover::after,
  .footer-social-list a:hover::after,
  .footer-legal-list a:hover::after {
    width: 100%;
  }

  .footer-bottom {
    border-top: 1px solid rgba(0, 212, 255, 0.1);
    padding-top: 2rem;
    text-align: center;
    position: relative;
  }

  .footer-bottom::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 1px;
    background: linear-gradient(90deg,
      transparent,
      var(--color-primary),
      transparent);
  }

  .footer-bottom p {
    font-family: 'Inter', sans-serif;
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin: 0;
    letter-spacing: 0.02em;
  }

  /* Responsive footer */
  @media (max-width: 870px) {
    .footer-content {
      grid-template-columns: 1fr;
      gap: var(--space-lg);
    }
    
    .footer-brand {
      max-width: none;
      text-align: center;
    }
    
    .footer-description p {
      max-width: none;
    }
  }

  @media (max-width: 1024px) and (min-width: 769px) {
    .footer-content {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-lg);
    }
  }

  /* Navigation overlay */
  .nav-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000000;
    z-index: 998;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .nav-overlay.active {
    opacity: 0.95;
    visibility: visible;
    pointer-events: auto;
  }

  /* Hamburger menu button */
  .nav-toggle {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 4px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    z-index: 1000;
  }

  .hamburger {
    display: block;
    width: 24px;
    height: 2px;
    background-color: var(--color-text);
    transition: all var(--transition-base);
  }

  .nav-toggle.active .hamburger:nth-child(1) {
    transform: translateY(6px) rotate(45deg);
  }

  .nav-toggle.active .hamburger:nth-child(2) {
    opacity: 0;
  }

  .nav-toggle.active .hamburger:nth-child(3) {
    transform: translateY(-6px) rotate(-45deg);
  }

  /* Mobile search in hamburger menu - hidden by default */
  .mobile-search {
    display: none;
  }

  /* Mobile price display - hidden by default */
  .mobile-price {
    display: none;
  }

  /* Hide price in header below 880px */
  @media (max-width: 880px) {
    .header-price-wrapper {
      display: none !important;
    }

    .nav-actions .price-display-item {
      display: none !important;
    }

    .nav-actions .price-display {
      display: none !important;
    }
  }

  @media (max-width: 870px) {
    /* Hide search bar in top nav on mobile */
    .nav-search {
      display: none;
    }

    /* Nav actions on mobile */
    .nav-actions {
      gap: var(--space-xs);
      flex-shrink: 0;
    }

    .nav-toggle {
      display: flex;
    }

    /* Bottom row becomes mobile menu */
    .nav-bottom-row {
      position: fixed;
      top: 64px;
      left: 0;
      right: 0;
      bottom: 0;
      height: auto;
      background: #000000;
      border-right: 1px solid var(--color-border);
      transform: translateX(-100%);
      transition: transform 0.3s ease, visibility 0.3s ease, opacity 0.3s ease;
      display: block;
      visibility: hidden;
      opacity: 0;
      z-index: 999;
      will-change: transform;
      -webkit-transform: translateX(-100%);
      -webkit-transition: -webkit-transform 0.3s ease;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }

    .nav-bottom-row.active {
      transform: translateX(0) translateZ(0);
      visibility: visible;
      opacity: 1;
      -webkit-transform: translateX(0) translateZ(0);
    }

    /* Mobile search in menu */
    .mobile-search {
      display: block;
      padding: 0 1.5rem 1rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--color-border);
    }

    /* Mobile price display */
    .mobile-price {
      display: block !important;
      padding: 1rem 1.5rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--color-border);
      background: rgba(99, 102, 241, 0.05);
    }

    /* Override PriceDisplay component's mobile hiding */
    .mobile-price .price-display {
      display: flex !important;
      justify-content: center;
      font-size: 16px !important;
    }

    /* Ensure all price elements are visible */
    .mobile-price .price-separator,
    .mobile-price .price-content,
    .mobile-price .token-symbol,
    .mobile-price .price-value,
    .mobile-price .price-change {
      display: inline-flex !important;
      visibility: visible !important;
    }

    .mobile-search-form {
      display: flex;
      align-items: center;
      position: relative;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--color-border);
      border-radius: 0.5rem;
      overflow: hidden;
      width: 100%;
    }

    .mobile-search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-text-muted);
      pointer-events: none;
      z-index: 1;
    }

    .mobile-search-input {
      width: 100%;
      padding: 0.875rem 1rem 0.875rem 2.75rem;
      background: transparent;
      border: none;
      color: var(--color-text);
      font-size: 1rem;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    .mobile-search-input::placeholder {
      color: var(--color-text-muted);
      opacity: 0.8;
    }

    .nav-bottom-content {
      height: auto;
      padding: 1.5rem 0;
      padding-bottom: 4rem;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .nav-links {
      flex-direction: column;
      gap: 0;
      height: auto;
      align-items: stretch;
      width: 100%;
      padding: 0;
      margin: 0;
    }

    .nav-links li {
      height: auto;
      width: 100%;
      margin: 0;
      padding: 0;
      list-style: none;
      display: block;
    }

    .nav-link {
      height: auto;
      padding: 1rem 1.5rem;
      margin: 0;
      width: 100%;
      font-size: 1rem;
      border-bottom: 1px solid var(--color-border);
      color: var(--color-text);
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Mega menu trigger on mobile */
    .has-mega-menu .nav-link {
      cursor: pointer;
    }

    .has-mega-menu .nav-link .nav-arrow {
      margin-left: auto;
      flex-shrink: 0;
    }

    .has-mega-menu .nav-link.submenu-open {
      background: rgba(99, 102, 241, 0.1);
      color: var(--color-primary);
    }

    .nav-link.active::after {
      display: none;
    }

    .nav-link:hover {
      color: var(--color-primary);
    }
  }
  
  /* Adjust main content to account for fixed header */
  main {
    padding-top: 112px; /* Account for two-row navigation */
  }

  @media (max-width: 870px) {
    main {
      padding-top: 64px; /* Single row on mobile */
    }
  }

  @media (max-width: 640px) {
    .footer-content {
      flex-direction: column;
      text-align: center;
    }
  }
</style>